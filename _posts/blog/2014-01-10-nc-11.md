---
layout: post
title: Twemproxy(Nutcracker)源码分析--redis request的解析
category: blog
---

	/*
	 * Reference: http://redis.io/topics/protocol
	 *
	 * Redis >= 1.2 uses the unified protocol to send requests to the Redis
	 * server. In the unified protocol all the arguments sent to the server
	 * are binary safe and every request has the following general form:
	 *
	 *   *<number of arguments> CR LF
	 *   $<number of bytes of argument 1> CR LF
	 *   <argument data> CR LF
	 *   ...
	 *   $<number of bytes of argument N> CR LF
	 *   <argument data> CR LF
	 *
	 * Before the unified request protocol, redis protocol for requests supported
	 * the following commands
	 * 1). Inline commands: simple commands where arguments are just space
	 *     separated strings. No binary safeness is possible.
	 * 2). Bulk commands: bulk commands are exactly like inline commands, but
	 *     the last argument is handled in a special way in order to allow for
	 *     a binary-safe last argument.
	 *
	 * Nutcracker only supports the Redis unified protocol for requests.
	 */
	 
	 Redis 在版本1.2以后使用了统一标准协议来发送请求道Redis 服务器.在这个协议中，所有发送至 Redis 服务器的参数都是二进制安全（binary safe）的。
	 以下是这个协议的一般形式：
	 *<参数数量> CR LF
	 $<参数 1 的字节数量> CR LF
	 <参数 1 的数据> CR LF
	 ...
	 $<参数 N 的字节数量> CR LF
	 <参数 N 的数据> CR LF
	 
	 
	 举个例子， 以下是一个命令协议的打印版本：
	 set命令(三个参数)： set mykey(5个字节) myvalue (七个字节)
	    
	 *3
	 $3
	 SET
	 $5
	 mykey
	 $7
	 myvalue
	 
	 这个命令的实际协议值如下：
	"*3\r\n$3\r\nSET\r\n$5\r\nmykey\r\n$7\r\nmyvalue\r\n"

	
	在标准的请求协议之前，redis请求协议还支持以下命令
	1.内联命令：通过空格 隔开字符参数串来的简单命令  不保证二进制安全
	2.批量命令: 批量命令和内联命令几乎一样， 但是最后一个参数用了一种特别的方式处理， 能够允许处理最后一个二进制安全的参数
	
	Nutcracker只支持 统一标准请求协议
	
	
	
	 